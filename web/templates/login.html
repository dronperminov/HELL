<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
</head>
<body>
    <form id="login-form" action="/login" method="post">
        <label>Login: <input type="text" name="username" value="admin"></label><br>
        <label>Password: <input type="password" name="password" value="admin"></label><br>
        <button type="submit">Login</button>
    </form>

    <span id="error-message"></span>

    <script>
        let form = document.getElementById("login-form")

        form.addEventListener("submit", async (event) => {
            event.preventDefault()
            let username = form.elements.username.value
            let password = form.elements.password.value
            console.log(username, password)
            let data = {username, password}

            try {
                let response = await fetch("/login", {
                    method: "POST",
                    body: Object.keys(data).map(key => encodeURIComponent(key) + '=' + encodeURIComponent(data[key])).join('&'),
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
                    }
                })

                if (!response.ok)
                    throw new Error(response.statusText)

                response = await response.json()
                console.log(response)

                if (response.status != "ok")
                    throw new Error(response.message)

                window.location.href = '/'
            } catch (error) {
                let errorMessage = document.getElementById("error-message");
                errorMessage.textContent = error.message;
            }
        });
    </script>
</body>
</html>